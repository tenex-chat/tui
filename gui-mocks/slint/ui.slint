import { VerticalBox, HorizontalBox, ScrollView } from "std-widgets.slint";

export global AppTheme {
    in property <color> bg_app: #111318;
    in property <color> bg_panel: #161a20;
    in property <color> bg_panel_hi: #1f242d;
    in property <color> bg_card: #1a1f26;
    in property <color> bg_card_hi: #232833;
    in property <color> border_soft: #242a34;
    in property <color> border_mid: #2c333f;
    in property <color> border_faint: #1d212a;
    in property <color> text_primary: #e5e9ee;
    in property <color> text_muted: #9aa3ad;
    in property <color> text_dim: #76808b;
    in property <color> text_faint: #5f6674;
    in property <color> accent_blue: #4f86ff;
    in property <color> accent_green: #3ec87c;
    in property <color> accent_yellow: #dea836;
    in property <color> accent_orange: #de7c42;
    in property <color> accent_purple: #7d66ff;
}

struct SidebarItem { name: string, color: color, active: bool }
struct CardItem { title: string, subtitle: string, status_text: string, status_color: color, time: string, tags: [string] }
struct ColumnItem { title: string, count: string, accent: color, cards: [CardItem] }
struct AgentItem { name: string, role: string, description: string, version: string }
struct PackItem { title: string, description: string, count: string }
struct ToolItem { name: string, description: string, command: string, caps: [string] }
struct NudgeItem { title: string, description: string, author: string, tags: [string] }
struct LessonItem { title: string, summary: string, author: string }
struct ThreadItem { title: string, subtitle: string, status_text: string, status_color: color, time: string, tags: [string] }
struct MessageItem { author: string, content: string, role: string, time: string }
struct DocItem { title: string, summary: string, updated: string }
struct FeedItem { title: string, summary: string, time: string }
struct AgentOption { name: string, model: string, online: bool }
struct ToolGroup { name: string, tools: [string] }

component Pill {
    in property <string> label;
    in property <color> bg;
    in property <color> fg;
    in property <int> radius: 6;
    Rectangle {
        background: bg;
        border-radius: radius * 1px;
        HorizontalBox {
            padding: 4px;
            Text {
                text: label;
                color: fg;
                font-size: 11px;
                horizontal-alignment: center;
                vertical-alignment: center;
            }
        }
    }
}

component BadgeSmall {
    in property <string> label;
    in property <color> bg;
    in property <color> fg;
    Rectangle {
        height: 11px;
        background: bg;
        border-radius: 4px;
        border-width: 1px;
        border-color: AppTheme.border_faint;
        HorizontalBox {
            padding: 2px;
            Text {
                text: label;
                color: fg;
                font-size: 7px;
                horizontal-alignment: center;
                vertical-alignment: center;
            }
        }
    }
}

component StatusPill {
    in property <string> label;
    in property <color> fg;
    Rectangle {
        height: 11px;
        background: #00000000;
        border-radius: 4px;
        border-width: 0px;
        HorizontalBox {
            padding: 2px;
            Text {
                text: label;
                color: fg;
                font-size: 7px;
                horizontal-alignment: center;
                vertical-alignment: center;
            }
        }
    }
}

component GhostButton {
    in property <string> label;
    callback clicked();
    Rectangle {
        background: AppTheme.bg_card_hi;
        border-radius: 6px;
        border-width: 1px;
        border-color: AppTheme.border_soft;
        HorizontalBox {
            padding: 6px;
            Text { text: label; color: AppTheme.text_muted; font-size: 11px; }
        }
        TouchArea { clicked => { root.clicked(); } }
    }
}

component MenuItem {
    in property <string> label;
    callback clicked();
    Rectangle {
        background: AppTheme.bg_card;
        border-radius: 8px;
        border-width: 1px;
        border-color: AppTheme.border_soft;
        height: 30px;
        HorizontalBox {
            padding: 6px;
            Text { text: label; color: AppTheme.text_primary; font-size: 11px; }
        }
        TouchArea { clicked => { root.clicked(); } }
    }
}

component PrimaryButton {
    in property <string> label;
    in property <color> bg: AppTheme.accent_blue;
    callback clicked();
    Rectangle {
        background: bg;
        border-radius: 8px;
        HorizontalBox {
            padding: 6px;
            Text { text: label; color: #101318; font-size: 11px; font-weight: 600; }
        }
        TouchArea { clicked => { root.clicked(); } }
    }
}

component IconDot {
    in property <color> fill;
    in property <int> size: 12;
    Rectangle {
        width: size * 1px;
        height: size * 1px;
        border-radius: 4px;
        background: fill;
    }
}

component AvatarDot {
    in property <color> fill;
    Rectangle {
        width: 9px;
        height: 9px;
        border-radius: 4px;
        background: fill;
    }
}

component MiniTab {
    in property <string> label;
    in property <bool> active: false;
    callback clicked();
    Rectangle {
        width: 26px;
        height: 20px;
        border-radius: 6px;
        background: active ? AppTheme.bg_card_hi : AppTheme.bg_panel;
        border-width: 1px;
        border-color: active ? AppTheme.border_mid : AppTheme.border_soft;
        Text {
            text: label;
            color: active ? AppTheme.text_primary : AppTheme.text_dim;
            font-size: 9px;
            horizontal-alignment: center;
            vertical-alignment: center;
        }
        TouchArea { clicked => { root.clicked(); } }
    }
}

component TabIcon {
    in property <string> label;
    in property <bool> active: false;
    in property <color> accent: AppTheme.accent_blue;
    Rectangle {
        width: 18px;
        height: 18px;
        background: #00000000;
        border-width: 0px;
        VerticalBox {
            padding: 1px;
            Text {
                text: label;
                color: active ? AppTheme.text_primary : AppTheme.text_dim;
                font-size: 9px;
                horizontal-alignment: center;
                vertical-alignment: center;
            }
            Rectangle {
                height: 2px;
                background: active ? accent : #00000000;
                border-radius: 1px;
            }
        }
    }
}

component TabDot {
    in property <bool> active: false;
    in property <color> accent: AppTheme.accent_blue;
    Rectangle {
        width: 11px;
        height: 11px;
        background: #00000000;
        Rectangle {
            width: active ? 6px : 4px;
            height: active ? 6px : 4px;
            border-radius: 3px;
            background: active ? accent : AppTheme.border_mid;
            x: (root.width - self.width) / 2;
            y: (root.height - self.height) / 2;
        }
        Rectangle {
            height: 1px;
            width: active ? 6px : 0px;
            background: active ? accent : #00000000;
            border-radius: 1px;
            x: (root.width - self.width) / 2;
            y: root.height - 1px;
        }
    }
}

component NavItem {
    in property <string> label;
    in property <string> screen_id;
    in property <string> active_screen;
    callback clicked(string);
    Rectangle {
        background: screen_id == active_screen ? AppTheme.bg_card_hi : AppTheme.bg_card;
        border-radius: 10px;
        border-width: 1px;
        border-color: screen_id == active_screen ? AppTheme.border_mid : AppTheme.border_soft;
        height: 32px;
        HorizontalBox {
            padding: 6px;
            spacing: 8px;
            Rectangle { width: 8px; height: 8px; border-radius: 4px; background: AppTheme.accent_blue; }
            Text { text: label; color: AppTheme.text_primary; font-size: 11px; }
        }
        TouchArea { clicked => { root.clicked(screen_id); } }
    }
}

component TinyIconButton {
    in property <string> label;
    in property <color> bg: #00000000;
    in property <color> fg: AppTheme.text_muted;
    callback clicked();
    Rectangle {
        width: 16px;
        height: 16px;
        border-radius: 4px;
        background: bg;
        border-width: 0px;
        Text {
            text: label;
            color: AppTheme.text_faint;
            font-size: 9px;
            horizontal-alignment: center;
            vertical-alignment: center;
        }
        TouchArea { clicked => { root.clicked(); } }
    }
}

component IconToggle {
    in property <string> label;
    in property <bool> active: false;
    callback clicked();
    Rectangle {
        width: 18px;
        height: 18px;
        border-radius: 4px;
        background: active ? AppTheme.bg_panel_hi : #00000000;
        border-width: active ? 1px : 0px;
        border-color: active ? AppTheme.border_faint : #00000000;
        Text {
            text: label;
            color: active ? AppTheme.text_primary : AppTheme.text_dim;
            font-size: 9px;
            horizontal-alignment: center;
            vertical-alignment: center;
        }
        TouchArea { clicked => { root.clicked(); } }
    }
}

component CardView {
    in property <CardItem> item;
    Rectangle {
        background: AppTheme.bg_panel;
        border-radius: 4px;
        border-width: 0px;
        HorizontalBox {
            spacing: 4px;
            Rectangle {
                width: 1px;
                border-radius: 1px;
                background: item.status_color;
                vertical-stretch: 1;
            }
            VerticalBox {
                padding: 4px;
                spacing: 2px;
                HorizontalBox {
                    spacing: 3px;
                    Text { text: item.title; color: AppTheme.text_primary; font-weight: 600; font-size: 9px; }
                    Rectangle { horizontal-stretch: 1; }
                    StatusPill { label: item.status_text; fg: item.status_color; }
                }
                Text { text: item.subtitle; color: AppTheme.text_dim; font-size: 8px; }
                HorizontalBox {
                    spacing: 1px;
                    AvatarDot { fill: AppTheme.accent_blue; }
                    AvatarDot { fill: AppTheme.accent_green; }
                    for tag[i] in item.tags : BadgeSmall { label: tag; bg: AppTheme.bg_panel_hi; fg: AppTheme.text_muted; }
                    Rectangle { horizontal-stretch: 1; }
                    Text { text: item.time; color: AppTheme.text_faint; font-size: 7px; }
                }
            }
        }
        Rectangle { height: 1px; background: AppTheme.border_faint; }
    }
}

component ColumnPanel {
    in property <ColumnItem> column;
    Rectangle {
        background: AppTheme.bg_panel;
        border-radius: 10px;
        border-width: 1px;
        border-color: AppTheme.border_faint;
        width: 270px;
        VerticalBox {
            padding: 4px;
            spacing: 1px;
            HorizontalBox {
                spacing: 4px;
                Rectangle {
                    width: 11px;
                    height: 11px;
                    border-radius: 4px;
                    background: column.accent;
                }
                Text { text: column.title; color: AppTheme.text_primary; font-size: 9px; font-weight: 600; }
                Text { text: column.count; color: AppTheme.text_faint; font-size: 7px; }
                Rectangle { horizontal-stretch: 1; }
                TinyIconButton { label: "S"; }
                Rectangle { width: 6px; height: 6px; border-radius: 3px; background: AppTheme.accent_green; }
            }
            HorizontalBox {
                spacing: 1px;
                TabDot { active: true; accent: column.accent; }
                TabDot { accent: column.accent; }
                TabDot { accent: column.accent; }
                TabDot { accent: column.accent; }
                TabDot { accent: column.accent; }
                Rectangle { horizontal-stretch: 1; }
                TinyIconButton { label: "A"; }
                TinyIconButton { label: "+"; }
                TinyIconButton { label: "P"; }
            }
            Rectangle { height: 1px; background: AppTheme.border_faint; }
            ScrollView {
                vertical-stretch: 1;
                VerticalBox {
                    spacing: 4px;
                    for card[i] in column.cards : CardView { item: card; }
                }
            }
        }
    }
}

component AgentCard {
    in property <AgentItem> agent;
    Rectangle {
        background: AppTheme.bg_card;
        border-radius: 12px;
        border-width: 1px;
        border-color: AppTheme.border_soft;
        VerticalBox {
            padding: 12px;
            spacing: 6px;
            HorizontalBox {
                spacing: 8px;
                Rectangle { width: 24px; height: 24px; border-radius: 12px; background: AppTheme.accent_purple; }
                VerticalBox {
                    Text { text: agent.name; color: AppTheme.text_primary; font-size: 12px; font-weight: 600; }
                    Text { text: agent.role; color: AppTheme.text_dim; font-size: 10px; }
                }
                Rectangle { horizontal-stretch: 1; }
                Pill { label: agent.version; bg: #2b303b; fg: AppTheme.text_muted; }
            }
            Text { text: agent.description; color: AppTheme.text_muted; font-size: 11px; }
        }
    }
}

component PackCard {
    in property <PackItem> pack;
    Rectangle {
        background: AppTheme.bg_card;
        border-radius: 12px;
        border-width: 1px;
        border-color: AppTheme.border_soft;
        VerticalBox {
            padding: 12px;
            spacing: 8px;
            Rectangle { height: 80px; border-radius: 10px; background: AppTheme.bg_card_hi; }
            Text { text: pack.title; color: AppTheme.text_primary; font-size: 12px; font-weight: 600; }
            Text { text: pack.description; color: AppTheme.text_muted; font-size: 11px; }
            HorizontalBox {
                spacing: 6px;
                Pill { label: pack.count; bg: AppTheme.accent_blue; fg: #101318; }
                Text { text: "Agents"; color: AppTheme.text_dim; font-size: 10px; }
            }
        }
    }
}

component ToolCard {
    in property <ToolItem> tool;
    Rectangle {
        background: AppTheme.bg_card;
        border-radius: 12px;
        border-width: 1px;
        border-color: AppTheme.border_soft;
        VerticalBox {
            padding: 12px;
            spacing: 8px;
            Text { text: tool.name; color: AppTheme.text_primary; font-size: 12px; font-weight: 600; }
            Text { text: tool.description; color: AppTheme.text_muted; font-size: 11px; }
            Rectangle { height: 1px; background: AppTheme.border_soft; }
            Text { text: tool.command; color: AppTheme.text_dim; font-size: 10px; }
            HorizontalBox {
                spacing: 6px;
                for cap[i] in tool.caps : Pill { label: cap; bg: #2b303b; fg: AppTheme.text_muted; radius: 5; }
            }
        }
    }
}

component NudgeCard {
    in property <NudgeItem> nudge;
    Rectangle {
        background: AppTheme.bg_card;
        border-radius: 12px;
        border-width: 1px;
        border-color: AppTheme.border_soft;
        VerticalBox {
            padding: 12px;
            spacing: 6px;
            HorizontalBox {
                Text { text: nudge.title; color: AppTheme.text_primary; font-size: 12px; font-weight: 600; }
                Rectangle { horizontal-stretch: 1; }
                Pill { label: nudge.author; bg: #2b303b; fg: AppTheme.text_muted; }
            }
            Text { text: nudge.description; color: AppTheme.text_muted; font-size: 11px; }
            HorizontalBox {
                spacing: 6px;
                for tag[i] in nudge.tags : Pill { label: tag; bg: #2b303b; fg: AppTheme.text_muted; radius: 5; }
            }
        }
    }
}

component LessonCard {
    in property <LessonItem> lesson;
    Rectangle {
        background: AppTheme.bg_card;
        border-radius: 12px;
        border-width: 1px;
        border-color: AppTheme.border_soft;
        VerticalBox {
            padding: 12px;
            spacing: 6px;
            Text { text: lesson.title; color: AppTheme.text_primary; font-size: 12px; font-weight: 600; }
            Text { text: lesson.summary; color: AppTheme.text_muted; font-size: 11px; }
            Text { text: lesson.author; color: AppTheme.text_dim; font-size: 10px; }
        }
    }
}

component ThreadRow {
    in property <ThreadItem> thread;
    Rectangle {
        background: AppTheme.bg_card;
        border-radius: 10px;
        border-width: 1px;
        border-color: AppTheme.border_soft;
        height: 78px;
        VerticalBox {
            padding: 10px;
            spacing: 4px;
            HorizontalBox {
                Text { text: thread.title; color: AppTheme.text_primary; font-size: 12px; font-weight: 600; }
                Rectangle { horizontal-stretch: 1; }
                Pill { label: thread.status_text; bg: thread.status_color; fg: #101318; }
            }
            Text { text: thread.subtitle; color: AppTheme.text_muted; font-size: 11px; }
            HorizontalBox {
                spacing: 6px;
                for tag[i] in thread.tags : Pill { label: tag; bg: #2b303b; fg: AppTheme.text_muted; radius: 5; }
                Rectangle { horizontal-stretch: 1; }
                Text { text: thread.time; color: AppTheme.text_dim; font-size: 10px; }
            }
        }
    }
}

component MessageBubble {
    in property <MessageItem> msg;
    Rectangle {
        background: AppTheme.bg_card;
        border-radius: 10px;
        border-width: 1px;
        border-color: AppTheme.border_soft;
        VerticalBox {
            padding: 10px;
            spacing: 4px;
            HorizontalBox {
                IconDot { fill: msg.role == "assistant" ? AppTheme.accent_green : AppTheme.accent_blue; size: 12; }
                Text { text: msg.author; color: AppTheme.text_primary; font-size: 11px; font-weight: 600; }
                Pill { label: msg.role; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; radius: 5; }
                Rectangle { horizontal-stretch: 1; }
                Text { text: msg.time; color: AppTheme.text_dim; font-size: 10px; }
            }
            Text { text: msg.content; color: AppTheme.text_muted; font-size: 11px; }
        }
    }
}

component DocCard {
    in property <DocItem> doc;
    Rectangle {
        background: AppTheme.bg_card;
        border-radius: 12px;
        border-width: 1px;
        border-color: AppTheme.border_soft;
        VerticalBox {
            padding: 12px;
            spacing: 6px;
            Text { text: doc.title; color: AppTheme.text_primary; font-size: 12px; font-weight: 600; }
            Text { text: doc.summary; color: AppTheme.text_muted; font-size: 11px; }
            Text { text: doc.updated; color: AppTheme.text_dim; font-size: 10px; }
        }
    }
}

component FeedCard {
    in property <FeedItem> item;
    Rectangle {
        background: AppTheme.bg_card;
        border-radius: 12px;
        border-width: 1px;
        border-color: AppTheme.border_soft;
        VerticalBox {
            padding: 12px;
            spacing: 6px;
            HorizontalBox {
                Text { text: item.title; color: AppTheme.text_primary; font-size: 12px; font-weight: 600; }
                Rectangle { horizontal-stretch: 1; }
                Text { text: item.time; color: AppTheme.text_dim; font-size: 10px; }
            }
            Text { text: item.summary; color: AppTheme.text_muted; font-size: 11px; }
        }
    }
}

component ScreenHeader {
    in property <string> title;
    in property <string> subtitle;
    Rectangle {
        background: AppTheme.bg_panel;
        border-radius: 12px;
        border-width: 1px;
        border-color: AppTheme.border_soft;
        height: 60px;
        HorizontalBox {
            padding: 12px;
            VerticalBox {
                Text { text: title; color: AppTheme.text_primary; font-size: 16px; font-weight: 700; }
                Text { text: subtitle; color: AppTheme.text_muted; font-size: 11px; }
            }
            Rectangle { horizontal-stretch: 1; }
        }
    }
}

component ToolbarRow {
    in property <string> left_label;
    in property <string> right_label;
    Rectangle {
        background: AppTheme.bg_panel;
        border-radius: 12px;
        border-width: 1px;
        border-color: AppTheme.border_soft;
        height: 42px;
        HorizontalBox {
            padding: 10px;
            Text { text: left_label; color: AppTheme.text_muted; font-size: 11px; }
            Rectangle { horizontal-stretch: 1; }
            Pill { label: right_label; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
        }
    }
}

component AgentSelectorDropdown {
    in property <[AgentOption]> options;
    Rectangle {
        background: AppTheme.bg_panel;
        border-radius: 12px;
        border-width: 1px;
        border-color: AppTheme.border_mid;
        VerticalBox {
            padding: 10px;
            spacing: 8px;
            Text { text: "Select agent"; color: AppTheme.text_dim; font-size: 10px; }
            Rectangle {
                height: 30px;
                border-radius: 8px;
                background: AppTheme.bg_card;
                border-width: 1px;
                border-color: AppTheme.border_soft;
                HorizontalBox {
                    padding: 6px;
                    Text { text: "Filter agents..."; color: AppTheme.text_faint; font-size: 10px; }
                }
            }
            ScrollView {
                vertical-stretch: 1;
                VerticalBox {
                    spacing: 6px;
                    for opt[i] in options : Rectangle {
                        background: AppTheme.bg_card;
                        border-radius: 8px;
                        border-width: 1px;
                        border-color: AppTheme.border_soft;
                        height: 38px;
                        HorizontalBox {
                            padding: 6px;
                            spacing: 8px;
                            Rectangle { width: 22px; height: 22px; border-radius: 11px; background: opt.online ? AppTheme.accent_green : AppTheme.bg_card_hi; }
                            VerticalBox {
                                Text { text: opt.name; color: AppTheme.text_primary; font-size: 11px; }
                                Text { text: opt.model; color: AppTheme.text_dim; font-size: 10px; }
                            }
                            Rectangle { horizontal-stretch: 1; }
                            Rectangle { width: 12px; height: 12px; border-radius: 6px; background: AppTheme.accent_blue; }
                        }
                    }
                }
            }
            Text { text: "Enter to select, Esc to close"; color: AppTheme.text_faint; font-size: 10px; }
        }
    }
}

component AgentConfigModal {
    in property <[ToolGroup]> tool_groups;
    Rectangle {
        background: #00000088;
        VerticalBox {
            padding: 40px;
            Rectangle {
                background: AppTheme.bg_panel;
                border-radius: 14px;
                border-width: 1px;
                border-color: AppTheme.border_mid;
                height: 520px;
                VerticalBox {
                    padding: 16px;
                    spacing: 12px;
                    HorizontalBox {
                        Text { text: "Agent Configuration"; color: AppTheme.text_primary; font-size: 14px; font-weight: 700; }
                        Rectangle { horizontal-stretch: 1; }
                        GhostButton { label: "Close"; }
                    }
                    Rectangle { height: 1px; background: AppTheme.border_soft; }
                    HorizontalBox {
                        spacing: 12px;
                        Rectangle {
                            width: 200px;
                            background: AppTheme.bg_card;
                            border-radius: 10px;
                            border-width: 1px;
                            border-color: AppTheme.border_soft;
                            VerticalBox {
                                padding: 10px;
                                spacing: 8px;
                                Text { text: "Models"; color: AppTheme.text_dim; font-size: 10px; }
                                Pill { label: "gpt-4.1"; bg: AppTheme.accent_blue; fg: #101318; }
                                Pill { label: "claude-4"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                                Pill { label: "gemini-pro"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                            }
                        }
                        Rectangle {
                            background: AppTheme.bg_card;
                            border-radius: 10px;
                            border-width: 1px;
                            border-color: AppTheme.border_soft;
                            vertical-stretch: 1;
                            HorizontalBox {
                                padding: 10px;
                                VerticalBox {
                                    spacing: 8px;
                                    Text { text: "Tools"; color: AppTheme.text_dim; font-size: 10px; }
                                    ScrollView {
                                        vertical-stretch: 1;
                                        VerticalBox {
                                            spacing: 8px;
                                            for group[i] in tool_groups : Rectangle {
                                                background: AppTheme.bg_panel_hi;
                                                border-radius: 8px;
                                                border-width: 1px;
                                                border-color: AppTheme.border_soft;
                                                VerticalBox {
                                                    padding: 8px;
                                                    spacing: 6px;
                                                    Text { text: group.name; color: AppTheme.text_primary; font-size: 11px; }
                                                    HorizontalBox {
                                                        spacing: 6px;
                                                        for tool[i] in group.tools : Pill { label: tool; bg: #2b303b; fg: AppTheme.text_muted; radius: 5; }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                    HorizontalBox {
                        Rectangle { horizontal-stretch: 1; }
                        PrimaryButton { label: "Save"; }
                    }
                }
            }
        }
    }
}

component DrawerWindow {
    in property <[MessageItem]> messages;
    Rectangle {
        background: AppTheme.bg_panel;
        border-radius: 12px;
        border-width: 1px;
        border-color: AppTheme.border_mid;
        width: 560px;
        VerticalBox {
            padding: 12px;
            spacing: 8px;
            VerticalBox {
                spacing: 6px;
                HorizontalBox {
                    spacing: 8px;
                    GhostButton { label: "<"; }
                    Text { text: "New Conversation"; color: AppTheme.text_primary; font-size: 13px; font-weight: 700; }
                    Pill { label: "TENEX Web Svelte"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; radius: 6; }
                    Rectangle { horizontal-stretch: 1; }
                    GhostButton { label: "Copy"; }
                    GhostButton { label: "View"; }
                    GhostButton { label: "Detach"; }
                    GhostButton { label: "Close"; }
                }
                Text { text: "Executive summary and timeline updates"; color: AppTheme.text_dim; font-size: 10px; }
            }
            Rectangle { height: 1px; background: AppTheme.border_soft; }
            ScrollView {
                vertical-stretch: 1;
                VerticalBox {
                    spacing: 8px;
                    for msg[i] in messages : MessageBubble { msg: msg; }
                }
            }
            Rectangle {
                background: AppTheme.bg_card;
                border-radius: 10px;
                border-width: 1px;
                border-color: AppTheme.border_soft;
                VerticalBox {
                    padding: 8px;
                    spacing: 6px;
                    HorizontalBox {
                        spacing: 6px;
                        Pill { label: "project-historian"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                        Pill { label: "master"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                        Pill { label: "#summary"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                        Rectangle { horizontal-stretch: 1; }
                        GhostButton { label: "Ask"; }
                    }
                    Rectangle {
                        height: 44px;
                        border-radius: 8px;
                        background: AppTheme.bg_panel_hi;
                        border-width: 1px;
                        border-color: AppTheme.border_soft;
                        HorizontalBox {
                            padding: 8px;
                            spacing: 8px;
                            Text { text: "Type a message..."; color: AppTheme.text_dim; font-size: 11px; }
                            Rectangle { horizontal-stretch: 1; }
                            PrimaryButton { label: "Send"; }
                        }
                    }
                }
            }
        }
    }
}

component DetachedWindow {
    in property <[MessageItem]> messages;
    Rectangle {
        background: AppTheme.bg_panel;
        border-radius: 12px;
        border-width: 1px;
        border-color: AppTheme.border_mid;
        width: 520px;
        height: 440px;
        VerticalBox {
            padding: 12px;
            spacing: 8px;
            HorizontalBox {
                Text { text: "Detached Chat"; color: AppTheme.text_primary; font-size: 12px; font-weight: 700; }
                Rectangle { horizontal-stretch: 1; }
                GhostButton { label: "Dock"; }
                GhostButton { label: "Close"; }
            }
            Rectangle { height: 1px; background: AppTheme.border_soft; }
            ScrollView {
                vertical-stretch: 1;
                VerticalBox {
                    spacing: 8px;
                    for msg[i] in messages : MessageBubble { msg: msg; }
                }
            }
            Rectangle {
                height: 36px;
                border-radius: 8px;
                background: AppTheme.bg_card;
                border-width: 1px;
                border-color: AppTheme.border_soft;
                HorizontalBox {
                    padding: 8px;
                    Text { text: "Reply..."; color: AppTheme.text_dim; font-size: 11px; }
                }
            }
        }
    }
}

component CreateProjectWizard {
    Rectangle {
        background: #00000088;
        VerticalBox {
            padding: 40px;
            Rectangle {
                background: AppTheme.bg_panel;
                border-radius: 14px;
                border-width: 1px;
                border-color: AppTheme.border_mid;
                height: 520px;
                VerticalBox {
                    padding: 16px;
                    spacing: 12px;
                    HorizontalBox {
                        Text { text: "Create Project"; color: AppTheme.text_primary; font-size: 14px; font-weight: 700; }
                        Rectangle { horizontal-stretch: 1; }
                        GhostButton { label: "Close"; }
                    }
                    Rectangle { height: 1px; background: AppTheme.border_soft; }
                    HorizontalBox {
                        spacing: 8px;
                        Pill { label: "Details"; bg: AppTheme.accent_blue; fg: #101318; }
                        Pill { label: "Agents"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                        Pill { label: "Tools"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                        Pill { label: "Review"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                    }
                    Rectangle { height: 1px; background: AppTheme.border_soft; }
                    VerticalBox {
                        spacing: 10px;
                        Text { text: "Project Details"; color: AppTheme.text_primary; font-size: 12px; font-weight: 600; }
                        Rectangle { height: 34px; border-radius: 8px; background: AppTheme.bg_card; }
                        Rectangle { height: 80px; border-radius: 8px; background: AppTheme.bg_card; }
                        HorizontalBox {
                            spacing: 6px;
                            Pill { label: "#tools"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                            Pill { label: "#design"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                        }
                    }
                    HorizontalBox {
                        Rectangle { horizontal-stretch: 1; }
                        GhostButton { label: "Back"; }
                        PrimaryButton { label: "Next"; }
                    }
                }
            }
        }
    }
}

component GlobalSearchDialog {
    Rectangle {
        background: #00000088;
        VerticalBox {
            padding: 60px;
            Rectangle {
                background: AppTheme.bg_panel;
                border-radius: 12px;
                border-width: 1px;
                border-color: AppTheme.border_mid;
                height: 260px;
                VerticalBox {
                    padding: 14px;
                    spacing: 10px;
                    Text { text: "Search conversations"; color: AppTheme.text_primary; font-size: 13px; font-weight: 600; }
                    Rectangle {
                        height: 36px;
                        border-radius: 8px;
                        background: AppTheme.bg_card;
                        border-width: 1px;
                        border-color: AppTheme.border_soft;
                        HorizontalBox {
                            padding: 8px;
                            Text { text: "Search by title, summary, tags..."; color: AppTheme.text_faint; font-size: 11px; }
                        }
                    }
                    Text { text: "Recent"; color: AppTheme.text_dim; font-size: 10px; }
                    Rectangle { height: 30px; border-radius: 6px; background: AppTheme.bg_card; }
                    Rectangle { height: 30px; border-radius: 6px; background: AppTheme.bg_card; }
                }
            }
        }
    }
}

component AgentDetailScreen {
    in property <[AgentItem]> agents;
    VerticalBox {
        spacing: 12px;
        ScreenHeader { title: "Agent Definition"; subtitle: "Details, instructions, and tools"; }
        Rectangle {
            background: AppTheme.bg_panel;
            border-radius: 12px;
            border-width: 1px;
            border-color: AppTheme.border_soft;
            VerticalBox {
                padding: 12px;
                spacing: 8px;
                HorizontalBox {
                    spacing: 8px;
                    GhostButton { label: "Back"; }
                    Text { text: agents[0].name; color: AppTheme.text_primary; font-size: 14px; font-weight: 700; }
                    Rectangle { horizontal-stretch: 1; }
                    GhostButton { label: "Fork"; }
                    GhostButton { label: "Clone"; }
                }
                Text { text: agents[0].description; color: AppTheme.text_muted; font-size: 11px; }
                HorizontalBox {
                    spacing: 6px;
                    Pill { label: agents[0].role; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                    Pill { label: "v" + agents[0].version; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                    Pill { label: "Owned"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                }
            }
        }
        Rectangle {
            background: AppTheme.bg_panel;
            border-radius: 12px;
            border-width: 1px;
            border-color: AppTheme.border_soft;
            VerticalBox {
                padding: 12px;
                spacing: 6px;
                Text { text: "Instructions"; color: AppTheme.text_primary; font-size: 12px; font-weight: 600; }
                Rectangle { height: 120px; border-radius: 8px; background: AppTheme.bg_card; }
            }
        }
        Rectangle {
            background: AppTheme.bg_panel;
            border-radius: 12px;
            border-width: 1px;
            border-color: AppTheme.border_soft;
            VerticalBox {
                padding: 12px;
                spacing: 6px;
                Text { text: "Tools & Capabilities"; color: AppTheme.text_primary; font-size: 12px; font-weight: 600; }
                HorizontalBox {
                    spacing: 6px;
                    Pill { label: "shell:run"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                    Pill { label: "docs:search"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                    Pill { label: "reports:write"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                }
            }
        }
        Rectangle {
            background: AppTheme.bg_panel;
            border-radius: 12px;
            border-width: 1px;
            border-color: AppTheme.border_soft;
            VerticalBox {
                padding: 12px;
                spacing: 6px;
                Text { text: "Use Criteria"; color: AppTheme.text_primary; font-size: 12px; font-weight: 600; }
                Text { text: "- Use when scope is unclear"; color: AppTheme.text_muted; font-size: 11px; }
                Text { text: "- Good for migration plans"; color: AppTheme.text_muted; font-size: 11px; }
            }
        }
    }
}

component PackDetailScreen {
    in property <[PackItem]> packs;
    in property <[AgentItem]> agents;
    VerticalBox {
        spacing: 12px;
        ScreenHeader { title: "Agent Pack"; subtitle: "Pack details and included agents"; }
        Rectangle {
            background: AppTheme.bg_panel;
            border-radius: 12px;
            border-width: 1px;
            border-color: AppTheme.border_soft;
            VerticalBox {
                padding: 12px;
                spacing: 6px;
                HorizontalBox {
                    spacing: 8px;
                    GhostButton { label: "Back"; }
                    Text { text: packs[0].title; color: AppTheme.text_primary; font-size: 14px; font-weight: 700; }
                    Rectangle { horizontal-stretch: 1; }
                    PrimaryButton { label: "Add to Project"; }
                }
                Text { text: packs[0].description; color: AppTheme.text_muted; font-size: 11px; }
                HorizontalBox {
                    spacing: 6px;
                    Pill { label: packs[0].count; bg: AppTheme.accent_blue; fg: #101318; }
                    Text { text: "Agents"; color: AppTheme.text_dim; font-size: 10px; }
                }
            }
        }
        ScrollView {
            vertical-stretch: 1;
            VerticalBox {
                spacing: 10px;
                for a[i] in agents : AgentCard { agent: a; }
            }
        }
    }
}

component ToolDetailScreen {
    in property <[ToolItem]> tools;
    VerticalBox {
        spacing: 12px;
        ScreenHeader { title: "MCP Tool"; subtitle: "Command, capabilities, and metadata"; }
        Rectangle {
            background: AppTheme.bg_panel;
            border-radius: 12px;
            border-width: 1px;
            border-color: AppTheme.border_soft;
            VerticalBox {
                padding: 12px;
                spacing: 8px;
                HorizontalBox {
                    spacing: 8px;
                    GhostButton { label: "Back"; }
                    Text { text: tools[0].name; color: AppTheme.text_primary; font-size: 14px; font-weight: 700; }
                    Rectangle { horizontal-stretch: 1; }
                    GhostButton { label: "Edit"; }
                    GhostButton { label: "Delete"; }
                }
                Text { text: tools[0].description; color: AppTheme.text_muted; font-size: 11px; }
                Text { text: tools[0].command; color: AppTheme.text_dim; font-size: 10px; }
                HorizontalBox {
                    spacing: 6px;
                    for cap[i] in tools[0].caps : Pill { label: cap; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                }
            }
        }
        Rectangle {
            background: AppTheme.bg_panel;
            border-radius: 12px;
            border-width: 1px;
            border-color: AppTheme.border_soft;
            VerticalBox {
                padding: 12px;
                spacing: 6px;
                Text { text: "Tool ID"; color: AppTheme.text_primary; font-size: 11px; }
                Rectangle { height: 30px; border-radius: 8px; background: AppTheme.bg_card; }
                GhostButton { label: "Copy"; }
            }
        }
    }
}

component SettingsScreen {
    VerticalBox {
        spacing: 12px;
        ScreenHeader { title: "Settings"; subtitle: "AI, call, appearance, notifications, upload, relays"; }
        Rectangle {
            background: AppTheme.bg_panel;
            border-radius: 12px;
            border-width: 1px;
            border-color: AppTheme.border_soft;
            VerticalBox {
                padding: 12px;
                spacing: 8px;
                HorizontalBox {
                    spacing: 6px;
                    Pill { label: "AI"; bg: AppTheme.accent_blue; fg: #101318; }
                    Pill { label: "Call"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                    Pill { label: "Appearance"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                    Pill { label: "Notifications"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                    Pill { label: "Upload"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                    Pill { label: "Relays"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                }
                Rectangle { height: 1px; background: AppTheme.border_soft; }
                VerticalBox {
                    spacing: 8px;
                    Text { text: "Default Provider"; color: AppTheme.text_dim; font-size: 10px; }
                    Rectangle { height: 32px; border-radius: 8px; background: AppTheme.bg_card; }
                    Text { text: "Voice Settings"; color: AppTheme.text_dim; font-size: 10px; }
                    Rectangle { height: 32px; border-radius: 8px; background: AppTheme.bg_card; }
                    Text { text: "Theme"; color: AppTheme.text_dim; font-size: 10px; }
                    Rectangle { height: 32px; border-radius: 8px; background: AppTheme.bg_card; }
                }
            }
        }
    }
}

component LoginScreen {
    VerticalBox {
        spacing: 12px;
        ScreenHeader { title: "TENEX"; subtitle: "Orchestrate AI Agents on Nostr"; }
        Rectangle {
            background: AppTheme.bg_panel;
            border-radius: 12px;
            border-width: 1px;
            border-color: AppTheme.border_soft;
            height: 240px;
            VerticalBox {
                padding: 20px;
                spacing: 10px;
                Text { text: "Welcome"; color: AppTheme.text_primary; font-size: 16px; font-weight: 700; }
                Text { text: "Sign in to continue"; color: AppTheme.text_muted; font-size: 11px; }
                PrimaryButton { label: "Get Started"; }
            }
        }
    }
}

component ProfileScreen {
    VerticalBox {
        spacing: 12px;
        ScreenHeader { title: "Profile"; subtitle: "User and agent profile"; }
        Rectangle {
            background: AppTheme.bg_panel;
            border-radius: 12px;
            border-width: 1px;
            border-color: AppTheme.border_soft;
            VerticalBox {
                padding: 12px;
                spacing: 8px;
                HorizontalBox {
                    spacing: 8px;
                    Rectangle { width: 48px; height: 48px; border-radius: 24px; background: AppTheme.accent_blue; }
                    VerticalBox {
                        Text { text: "Pablo Testing"; color: AppTheme.text_primary; font-size: 14px; font-weight: 700; }
                        Text { text: "@npub..."; color: AppTheme.text_dim; font-size: 10px; }
                        Pill { label: "PM"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                    }
                }
                Rectangle { height: 1px; background: AppTheme.border_soft; }
                HorizontalBox {
                    spacing: 6px;
                    Pill { label: "Profile"; bg: AppTheme.accent_blue; fg: #101318; }
                    Pill { label: "Lessons"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                    Pill { label: "Feed"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                    Pill { label: "Settings"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                }
                Rectangle { height: 1px; background: AppTheme.border_soft; }
                Text { text: "Agent profile content and metadata."; color: AppTheme.text_muted; font-size: 11px; }
            }
        }
    }
}

component LessonsScreen {
    in property <[LessonItem]> lessons;
    HorizontalBox {
        spacing: 12px;
        Rectangle {
            width: 260px;
            background: AppTheme.bg_panel;
            border-radius: 12px;
            border-width: 1px;
            border-color: AppTheme.border_soft;
            VerticalBox {
                padding: 12px;
                spacing: 8px;
                Text { text: "Lessons"; color: AppTheme.text_primary; font-size: 12px; font-weight: 600; }
                ScrollView {
                    vertical-stretch: 1;
                    VerticalBox {
                        spacing: 8px;
                        for lesson[i] in lessons : LessonCard { lesson: lesson; }
                    }
                }
            }
        }
        VerticalBox {
            spacing: 12px;
            ScreenHeader { title: "Lesson Detail"; subtitle: "Guidance and learnings"; }
            Rectangle {
                background: AppTheme.bg_panel;
                border-radius: 12px;
                border-width: 1px;
                border-color: AppTheme.border_soft;
                VerticalBox {
                    padding: 12px;
                    spacing: 6px;
                    Text { text: lessons[0].title; color: AppTheme.text_primary; font-size: 14px; font-weight: 700; }
                    Text { text: lessons[0].summary; color: AppTheme.text_muted; font-size: 11px; }
                    Text { text: "Author: " + lessons[0].author; color: AppTheme.text_dim; font-size: 10px; }
                    Rectangle { height: 140px; border-radius: 8px; background: AppTheme.bg_card; }
                }
            }
        }
    }
}

component NudgesScreen {
    in property <[NudgeItem]> nudges;
    HorizontalBox {
        spacing: 12px;
        Rectangle {
            width: 220px;
            background: AppTheme.bg_panel;
            border-radius: 12px;
            border-width: 1px;
            border-color: AppTheme.border_soft;
            VerticalBox {
                padding: 12px;
                spacing: 8px;
                Text { text: "Filters"; color: AppTheme.text_primary; font-size: 12px; font-weight: 600; }
                Rectangle { height: 28px; border-radius: 8px; background: AppTheme.bg_card; }
                Text { text: "Authors"; color: AppTheme.text_dim; font-size: 10px; }
                Rectangle { height: 28px; border-radius: 8px; background: AppTheme.bg_card; }
                Text { text: "Tags"; color: AppTheme.text_dim; font-size: 10px; }
                Rectangle { height: 28px; border-radius: 8px; background: AppTheme.bg_card; }
                PrimaryButton { label: "New Nudge"; }
            }
        }
        VerticalBox {
            spacing: 10px;
            ScreenHeader { title: "Agent Nudges"; subtitle: "Reusable instructions and prompts"; }
            ScrollView {
                vertical-stretch: 1;
                VerticalBox {
                    spacing: 10px;
                    for n[i] in nudges : NudgeCard { nudge: n; }
                }
            }
        }
    }
}

component ToolsScreen {
    in property <[ToolItem]> tools;
    VerticalBox {
        spacing: 12px;
        ScreenHeader { title: "MCP Tools"; subtitle: "Manage tool definitions"; }
        ToolbarRow { left_label: "Search tools"; right_label: "New Tool"; }
        ScrollView {
            vertical-stretch: 1;
            VerticalBox {
                spacing: 10px;
                for t[i] in tools : ToolCard { tool: t; }
            }
        }
    }
}

component PacksScreen {
    in property <[PackItem]> packs;
    VerticalBox {
        spacing: 12px;
        ScreenHeader { title: "Agent Packs"; subtitle: "Curated agent bundles"; }
        ToolbarRow { left_label: "Search packs"; right_label: "Create Pack"; }
        ScrollView {
            vertical-stretch: 1;
            VerticalBox {
                spacing: 10px;
                for p[i] in packs : PackCard { pack: p; }
            }
        }
    }
}

component AgentsScreen {
    in property <[AgentItem]> agents;
    VerticalBox {
        spacing: 12px;
        ScreenHeader { title: "Agent Definitions"; subtitle: "Templates and profiles"; }
        ToolbarRow { left_label: "Search agents"; right_label: "Create Agent"; }
        ScrollView {
            vertical-stretch: 1;
            VerticalBox {
                spacing: 10px;
                for a[i] in agents : AgentCard { agent: a; }
            }
        }
    }
}

component StatusScreen {
    in property <[ColumnItem]> status_columns;
    VerticalBox {
        spacing: 12px;
        ScreenHeader { title: "Status Dashboard"; subtitle: "Grouped by conversation status"; }
        HorizontalBox {
            spacing: 12px;
            for column[i] in status_columns : ColumnPanel { column: column; }
        }
    }
}

component HomeScreen {
    in property <[ColumnItem]> columns;
    HorizontalBox {
        spacing: 6px;
        for column[i] in columns : ColumnPanel { column: column; }
    }
}

component SidebarRow {
    in property <SidebarItem> item;
    Rectangle {
        background: item.active ? AppTheme.bg_card : #00000000;
        border-radius: 8px;
        border-width: item.active ? 1px : 0px;
        border-color: item.active ? AppTheme.border_faint : #00000000;
        height: 28px;
        HorizontalBox {
            spacing: 8px;
            padding: 6px;
            Rectangle {
                width: 2px;
                height: 14px;
                border-radius: 2px;
                background: item.active ? AppTheme.accent_blue : #00000000;
            }
            Rectangle { width: 14px; height: 14px; border-radius: 4px; background: item.color; }
            Text { text: item.name; color: AppTheme.text_primary; font-size: 10px; }
            Rectangle { horizontal-stretch: 1; }
        }
    }
}

component AppSidebar {
    in property <[SidebarItem]> items;
    in property <string> active_screen;
    callback toggle_view();
    callback open_user_menu();
    callback open_filter_menu();
    Rectangle {
        width: 205px;
        background: AppTheme.bg_panel;
        border-radius: 12px;
        border-width: 1px;
        border-color: AppTheme.border_faint;
        VerticalBox {
            padding: 6px;
            spacing: 5px;
            HorizontalBox {
                spacing: 8px;
                Text { text: "TENEX"; color: AppTheme.text_primary; font-size: 13px; font-weight: 700; }
                Rectangle { horizontal-stretch: 1; }
                IconToggle { label: "G"; active: active_screen == "status"; clicked => { root.toggle_view(); } }
                IconToggle { label: "C"; active: active_screen != "status"; clicked => { root.toggle_view(); } }
            }
            HorizontalBox {
                spacing: 6px;
                Rectangle { width: 12px; height: 12px; border-radius: 4px; background: AppTheme.accent_blue; }
                Rectangle { width: 12px; height: 12px; border-radius: 4px; background: AppTheme.accent_green; }
                Rectangle { width: 12px; height: 12px; border-radius: 4px; background: AppTheme.accent_orange; }
                Rectangle { width: 12px; height: 12px; border-radius: 4px; background: AppTheme.accent_purple; }
            }
            Text { text: "PROJECTS"; color: AppTheme.text_faint; font-size: 8px; }
            VerticalBox {
                spacing: 3px;
                for entry[i] in items : SidebarRow { item: entry; }
            }
            Rectangle { vertical-stretch: 1; }
            Rectangle {
                background: AppTheme.bg_card;
                border-radius: 10px;
                border-width: 1px;
                border-color: AppTheme.border_faint;
                height: 28px;
                HorizontalBox {
                    spacing: 8px;
                    padding: 6px;
                    Rectangle { width: 14px; height: 14px; border-radius: 4px; background: AppTheme.accent_orange; }
                    Text { text: "Inbox"; color: AppTheme.text_primary; font-size: 10px; }
                    Rectangle { horizontal-stretch: 1; }
                    BadgeSmall { label: "2"; bg: AppTheme.accent_orange; fg: #101318; }
                }
            }
            Rectangle {
                background: AppTheme.bg_panel;
                border-radius: 10px;
                border-width: 1px;
                border-color: AppTheme.border_faint;
                height: 40px;
                HorizontalBox {
                    spacing: 8px;
                    padding: 8px;
                    Rectangle { width: 22px; height: 22px; border-radius: 11px; background: AppTheme.accent_blue; }
                    VerticalBox {
                        Text { text: "Pablo Testing"; color: AppTheme.text_primary; font-size: 10px; font-weight: 600; }
                        Text { text: "@npub..."; color: AppTheme.text_dim; font-size: 10px; }
                    }
                    Rectangle { horizontal-stretch: 1; }
                    TinyIconButton { label: "..."; }
                }
                TouchArea { clicked => { root.open_user_menu(); } }
            }
            Rectangle {
                background: AppTheme.bg_panel;
                border-radius: 10px;
                border-width: 1px;
                border-color: AppTheme.border_faint;
                height: 28px;
                HorizontalBox {
                    spacing: 8px;
                    padding: 6px;
                    Rectangle { width: 10px; height: 10px; border-radius: 3px; background: AppTheme.bg_card_hi; }
                    Text { text: "Filter"; color: AppTheme.text_primary; font-size: 10px; }
                    Text { text: "Active in last 3 days"; color: AppTheme.text_dim; font-size: 9px; }
                }
                TouchArea { clicked => { root.open_filter_menu(); } }
            }
        }
    }
}

component SidebarMenuOverlay {
    in property <string> active_screen;
    callback select_screen(string);
    Rectangle {
        background: AppTheme.bg_panel;
        border-radius: 12px;
        border-width: 1px;
        border-color: AppTheme.border_mid;
        width: 220px;
        VerticalBox {
            padding: 10px;
            spacing: 6px;
            Text { text: "Menu"; color: AppTheme.text_dim; font-size: 10px; }
            MenuItem { label: "New project"; clicked => { root.select_screen("home"); } }
            MenuItem { label: "Agents"; clicked => { root.select_screen("agents"); } }
            MenuItem { label: "MCP Tools"; clicked => { root.select_screen("tools"); } }
            MenuItem { label: "Agent Nudges"; clicked => { root.select_screen("nudges"); } }
            MenuItem { label: "Settings"; clicked => { root.select_screen("settings"); } }
            Rectangle { height: 1px; background: AppTheme.border_soft; }
            Text { text: "Pages"; color: AppTheme.text_dim; font-size: 10px; }
            MenuItem { label: "Status Dashboard"; clicked => { root.select_screen("status"); } }
            MenuItem { label: "Conversations"; clicked => { root.select_screen("conversations"); } }
            MenuItem { label: "Docs"; clicked => { root.select_screen("docs"); } }
            MenuItem { label: "Feed"; clicked => { root.select_screen("feed"); } }
            MenuItem { label: "Agent Detail"; clicked => { root.select_screen("agent-detail"); } }
            MenuItem { label: "Packs"; clicked => { root.select_screen("packs"); } }
            MenuItem { label: "Pack Detail"; clicked => { root.select_screen("pack-detail"); } }
            MenuItem { label: "Tool Detail"; clicked => { root.select_screen("tool-detail"); } }
            MenuItem { label: "Lessons"; clicked => { root.select_screen("lessons"); } }
            MenuItem { label: "Profile"; clicked => { root.select_screen("profile"); } }
            MenuItem { label: "Login"; clicked => { root.select_screen("login"); } }
            Rectangle { height: 1px; background: AppTheme.border_soft; }
            MenuItem { label: "Logout"; }
        }
    }
}

component FilterMenuOverlay {
    Rectangle {
        background: AppTheme.bg_panel;
        border-radius: 12px;
        border-width: 1px;
        border-color: AppTheme.border_mid;
        width: 220px;
        VerticalBox {
            padding: 10px;
            spacing: 6px;
            MenuItem { label: "All conversations"; }
            MenuItem { label: "Only by me"; }
            Rectangle { height: 1px; background: AppTheme.border_soft; }
            Text { text: "Activity filters"; color: AppTheme.text_dim; font-size: 10px; }
            Rectangle {
                background: AppTheme.bg_card;
                border-radius: 8px;
                border-width: 1px;
                border-color: AppTheme.border_soft;
                height: 28px;
                HorizontalBox {
                    padding: 6px;
                    Text { text: "Active in last hour"; color: AppTheme.text_primary; font-size: 10px; }
                }
            }
            Rectangle {
                background: AppTheme.bg_card;
                border-radius: 8px;
                border-width: 1px;
                border-color: AppTheme.border_soft;
                height: 28px;
                HorizontalBox {
                    padding: 6px;
                    Text { text: "Active in last 4 hours"; color: AppTheme.text_primary; font-size: 10px; }
                }
            }
            Rectangle {
                background: AppTheme.bg_card;
                border-radius: 8px;
                border-width: 1px;
                border-color: AppTheme.border_soft;
                height: 28px;
                HorizontalBox {
                    padding: 6px;
                    Text { text: "Active in last 24 hours"; color: AppTheme.text_primary; font-size: 10px; }
                }
            }
            Rectangle {
                background: AppTheme.bg_card;
                border-radius: 8px;
                border-width: 1px;
                border-color: AppTheme.border_soft;
                height: 28px;
                HorizontalBox {
                    padding: 6px;
                    Text { text: "Active in last 3 days"; color: AppTheme.text_primary; font-size: 10px; }
                    Rectangle { horizontal-stretch: 1; }
                    Text { text: "OK"; color: AppTheme.accent_green; font-size: 10px; }
                }
            }
            Rectangle {
                background: AppTheme.bg_card;
                border-radius: 8px;
                border-width: 1px;
                border-color: AppTheme.border_soft;
                height: 28px;
                HorizontalBox {
                    padding: 6px;
                    Text { text: "Active in last 7 days"; color: AppTheme.text_primary; font-size: 10px; }
                }
            }
        }
    }
}

component MessageContextMenu {
    Rectangle {
        background: AppTheme.bg_panel;
        border-radius: 12px;
        border-width: 1px;
        border-color: AppTheme.border_mid;
        width: 200px;
        VerticalBox {
            padding: 8px;
            spacing: 4px;
            MenuItem { label: "Reply"; }
            MenuItem { label: "Quote"; }
            MenuItem { label: "Copy content"; }
            MenuItem { label: "Copy raw event"; }
            MenuItem { label: "Copy Hex ID"; }
            MenuItem { label: "Send Again"; }
            MenuItem { label: "View LLM metadata"; }
            MenuItem { label: "View raw event"; }
            MenuItem { label: "Open trace"; }
        }
    }
}

component DocsScreen {
    in property <[DocItem]> docs;
    VerticalBox {
        spacing: 12px;
        ScreenHeader { title: "Documents"; subtitle: "Project docs and notes"; }
        Rectangle {
            background: AppTheme.bg_panel;
            border-radius: 12px;
            border-width: 1px;
            border-color: AppTheme.border_soft;
            height: 42px;
            HorizontalBox {
                padding: 10px;
                Text { text: "Search documents..."; color: AppTheme.text_faint; font-size: 11px; }
                Rectangle { horizontal-stretch: 1; }
                Pill { label: "New"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
            }
        }
        ScrollView {
            vertical-stretch: 1;
            VerticalBox {
                spacing: 10px;
                for d[i] in docs : DocCard { doc: d; }
            }
        }
    }
}

component FeedScreen {
    in property <[FeedItem]> feed_items;
    VerticalBox {
        spacing: 12px;
        ScreenHeader { title: "Feed"; subtitle: "Project activity"; }
        ScrollView {
            vertical-stretch: 1;
            VerticalBox {
                spacing: 10px;
                for f[i] in feed_items : FeedCard { item: f; }
            }
        }
    }
}

component ConversationListScreen {
    in property <[ThreadItem]> threads;
    VerticalBox {
        spacing: 12px;
        ScreenHeader { title: "Conversations"; subtitle: "Threads and replies"; }
        Rectangle {
            background: AppTheme.bg_panel;
            border-radius: 12px;
            border-width: 1px;
            border-color: AppTheme.border_soft;
            height: 42px;
            HorizontalBox {
                padding: 10px;
                Text { text: "Search conversations..."; color: AppTheme.text_faint; font-size: 11px; }
                Rectangle { horizontal-stretch: 1; }
                Pill { label: "All"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
                Pill { label: "Only by me"; bg: AppTheme.bg_card_hi; fg: AppTheme.text_muted; }
            }
        }
        ScrollView {
            vertical-stretch: 1;
            VerticalBox {
                spacing: 10px;
                for t[i] in threads : ThreadRow { thread: t; }
            }
        }
    }
}

export component AppWindow inherits Window {
    in-out property <string> active_screen: "home";
    in-out property <bool> show_drawer: false;
    in-out property <bool> show_detached: false;
    in-out property <bool> show_agent_selector: false;
    in-out property <bool> show_agent_config: false;
    in-out property <bool> show_create_project: false;
    in-out property <bool> show_global_search: false;
    in-out property <bool> show_sidebar_menu: false;
    in-out property <bool> show_filter_menu: false;
    in-out property <bool> show_context_menu: false;

    in property <[SidebarItem]> workspace_items;
    in property <[ColumnItem]> home_columns;
    in property <[ColumnItem]> status_columns;
    in property <[AgentItem]> agents;
    in property <[PackItem]> packs;
    in property <[ToolItem]> tools;
    in property <[NudgeItem]> nudges;
    in property <[LessonItem]> lessons;
    in property <[ThreadItem]> threads;
    in property <[MessageItem]> messages;
    in property <[DocItem]> docs;
    in property <[FeedItem]> feeds;
    in property <[AgentOption]> agent_options;
    in property <[ToolGroup]> tool_groups;

    width: 1500px;
    height: 900px;
    background: AppTheme.bg_app;

    HorizontalBox {
        spacing: 8px;
        padding: 8px;
        AppSidebar {
            items: root.workspace_items;
            active_screen: root.active_screen;
            toggle_view => { root.active_screen = root.active_screen == "status" ? "home" : "status"; }
            open_user_menu => { root.show_sidebar_menu = !root.show_sidebar_menu; }
            open_filter_menu => { root.show_filter_menu = !root.show_filter_menu; }
        }

        Rectangle {
            background: AppTheme.bg_app;
            border-radius: 12px;
            border-width: 1px;
            border-color: AppTheme.border_soft;
            vertical-stretch: 1;
            HorizontalBox {
                padding: 12px;
                if (root.active_screen == "home") : HomeScreen { columns: root.home_columns; }
                if (root.active_screen == "status") : StatusScreen { status_columns: root.status_columns; }
                if (root.active_screen == "conversations") : ConversationListScreen { threads: root.threads; }
                if (root.active_screen == "docs") : DocsScreen { docs: root.docs; }
                if (root.active_screen == "feed") : FeedScreen { feed_items: root.feeds; }
                if (root.active_screen == "agents") : AgentsScreen { agents: root.agents; }
                if (root.active_screen == "agent-detail") : AgentDetailScreen { agents: root.agents; }
                if (root.active_screen == "packs") : PacksScreen { packs: root.packs; }
                if (root.active_screen == "pack-detail") : PackDetailScreen { packs: root.packs; agents: root.agents; }
                if (root.active_screen == "tools") : ToolsScreen { tools: root.tools; }
                if (root.active_screen == "tool-detail") : ToolDetailScreen { tools: root.tools; }
                if (root.active_screen == "settings") : SettingsScreen { }
                if (root.active_screen == "nudges") : NudgesScreen { nudges: root.nudges; }
                if (root.active_screen == "lessons") : LessonsScreen { lessons: root.lessons; }
                if (root.active_screen == "profile") : ProfileScreen { }
                if (root.active_screen == "login") : LoginScreen { }
            }
        }

        if (root.show_drawer) : DrawerWindow { messages: root.messages; }
    }

    if (root.show_detached) : DetachedWindow { messages: root.messages; x: 860px; y: 90px; }
    if (root.show_agent_selector) : AgentSelectorDropdown { options: root.agent_options; x: 880px; y: 620px; width: 280px; height: 240px; }
    if (root.show_agent_config) : AgentConfigModal { tool_groups: root.tool_groups; }
    if (root.show_create_project) : CreateProjectWizard { }
    if (root.show_global_search) : GlobalSearchDialog { }
    if (root.show_sidebar_menu) : SidebarMenuOverlay { active_screen: root.active_screen; select_screen(id) => { root.active_screen = id; } x: 32px; y: 520px; }
    if (root.show_filter_menu) : FilterMenuOverlay { x: 260px; y: 470px; }
    if (root.show_context_menu) : MessageContextMenu { x: 1060px; y: 180px; }
}
