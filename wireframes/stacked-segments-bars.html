<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stacked Segments Bar Chart</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #1a1a2e;
            color: #e0e0e0;
            font-family: 'Courier New', 'Consolas', monospace;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            font-size: 20px;
            margin-bottom: 20px;
            color: #ffffff;
            border-bottom: 2px solid #444;
            padding-bottom: 10px;
        }

        .legend {
            display: flex;
            gap: 30px;
            margin-bottom: 20px;
            padding: 10px 15px;
            border: 2px solid #444;
            background: #252540;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
        }

        .legend-char {
            font-size: 16px;
            padding: 2px 4px;
        }

        .chart-container {
            border: 2px solid #444;
            background: #1a1a2e;
            overflow: auto;
        }

        .bar-row {
            display: flex;
            align-items: center;
            padding: 8px 10px;
            border-bottom: 1px solid #333;
            cursor: pointer;
            transition: background 0.2s;
        }

        .bar-row:hover {
            background: #252540;
        }

        .date-col {
            width: 80px;
            font-size: 13px;
            color: #aaa;
            flex-shrink: 0;
            text-align: right;
            padding-right: 15px;
        }

        .bar-col {
            flex: 1;
            display: flex;
            align-items: center;
            min-width: 300px;
            max-width: 600px;
        }

        .runtime-col {
            width: 100px;
            text-align: left;
            padding-left: 15px;
            font-size: 13px;
            color: #888;
            flex-shrink: 0;
        }

        .segment {
            display: inline-block;
            white-space: nowrap;
            font-size: 16px;
            line-height: 1;
            letter-spacing: 0;
        }

        .segment-thinking {
            color: #f59e0b;
        }

        .segment-completion {
            color: #3b82f6;
        }

        .segment-prompt {
            color: #06b6d4;
        }

        /* Tooltip */
        .tooltip {
            position: fixed;
            background: #252540;
            border: 2px solid #666;
            padding: 15px;
            font-size: 12px;
            color: #e0e0e0;
            pointer-events: none;
            display: none;
            z-index: 1000;
            min-width: 250px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
        }

        .tooltip-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 6px;
        }

        .tooltip-label {
            color: #888;
        }

        .tooltip-value {
            color: #fff;
            font-weight: bold;
        }

        .tooltip-title {
            color: #3b82f6;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 10px;
            border-bottom: 1px solid #444;
            padding-bottom: 5px;
        }

        .tooltip-token-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .tooltip-token-char {
            font-size: 14px;
        }

        .empty-space {
            color: #333;
            font-size: 16px;
        }

        @media (max-width: 768px) {
            .legend {
                flex-wrap: wrap;
            }
            .runtime-col {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Stacked Segments (Token Composition)</h1>

        <div class="legend">
            <div class="legend-item">
                <span class="legend-char segment-thinking">█</span>
                <span>Thinking Tokens</span>
            </div>
            <div class="legend-item">
                <span class="legend-char segment-completion">▓</span>
                <span>Completion Tokens</span>
            </div>
            <div class="legend-item">
                <span class="legend-char segment-prompt">▒</span>
                <span>Prompt Tokens</span>
            </div>
        </div>

        <div class="chart-container" id="chart"></div>
    </div>

    <div class="tooltip" id="tooltip"></div>

    <script>
        const data = [
            {"date": "Today", "runtime_ms": 86580000, "cost": 12.45, "tokens": 452000, "messages": 234, "thinking_tokens": 150000, "completion_tokens": 180000, "prompt_tokens": 122000, "dominant_model": "GPT-4o"},
            {"date": "Jan 28", "runtime_ms": 43200000, "cost": 3.87, "tokens": 189000, "messages": 112, "thinking_tokens": 0, "completion_tokens": 89000, "prompt_tokens": 100000, "dominant_model": "Claude Sonnet"},
            {"date": "Jan 27", "runtime_ms": 167640000, "cost": 38.92, "tokens": 876000, "messages": 567, "thinking_tokens": 350000, "completion_tokens": 350000, "prompt_tokens": 176000, "dominant_model": "GPT-4o"},
            {"date": "Jan 26", "runtime_ms": 52200000, "cost": 8.23, "tokens": 234000, "messages": 156, "thinking_tokens": 0, "completion_tokens": 112000, "prompt_tokens": 122000, "dominant_model": "Claude Sonnet"},
            {"date": "Jan 25", "runtime_ms": 28800000, "cost": 2.15, "tokens": 98000, "messages": 67, "thinking_tokens": 0, "completion_tokens": 45000, "prompt_tokens": 53000, "dominant_model": "GPT-4o"},
            {"date": "Jan 24", "runtime_ms": 95040000, "cost": 18.76, "tokens": 512000, "messages": 298, "thinking_tokens": 256000, "completion_tokens": 150000, "prompt_tokens": 106000, "dominant_model": "o1"},
            {"date": "Jan 23", "runtime_ms": 72000000, "cost": 42.15, "tokens": 689000, "messages": 412, "thinking_tokens": 380000, "completion_tokens": 180000, "prompt_tokens": 129000, "dominant_model": "o1"},
            {"date": "Jan 22", "runtime_ms": 36000000, "cost": 4.56, "tokens": 145000, "messages": 89, "thinking_tokens": 0, "completion_tokens": 68000, "prompt_tokens": 77000, "dominant_model": "Claude Sonnet"},
            {"date": "Jan 21", "runtime_ms": 108000000, "cost": 25.89, "tokens": 623000, "messages": 345, "thinking_tokens": 0, "completion_tokens": 340000, "prompt_tokens": 283000, "dominant_model": "GPT-4o"},
            {"date": "Jan 20", "runtime_ms": 57600000, "cost": 7.34, "tokens": 267000, "messages": 178, "thinking_tokens": 134000, "completion_tokens": 67000, "prompt_tokens": 66000, "dominant_model": "Mixed"},
            {"date": "Jan 19", "runtime_ms": 144000000, "cost": 52.67, "tokens": 745000, "messages": 489, "thinking_tokens": 410000, "completion_tokens": 200000, "prompt_tokens": 135000, "dominant_model": "o1"},
            {"date": "Jan 18", "runtime_ms": 43200000, "cost": 5.12, "tokens": 201000, "messages": 123, "thinking_tokens": 0, "completion_tokens": 95000, "prompt_tokens": 106000, "dominant_model": "Claude Sonnet"},
            {"date": "Jan 17", "runtime_ms": 82800000, "cost": 16.78, "tokens": 445000, "messages": 267, "thinking_tokens": 178000, "completion_tokens": 156000, "prompt_tokens": 111000, "dominant_model": "GPT-4o"},
            {"date": "Jan 16", "runtime_ms": 64800000, "cost": 9.23, "tokens": 312000, "messages": 198, "thinking_tokens": 0, "completion_tokens": 168000, "prompt_tokens": 144000, "dominant_model": "Mixed"}
        ];

        const MAX_BAR_CHARS = 50;
        const CHAR_THINKING = '█';
        const CHAR_COMPLETION = '▓';
        const CHAR_PROMPT = '▒';
        const CHAR_EMPTY = ' ';

        function formatDuration(ms) {
            const hours = Math.floor(ms / 3600000);
            const minutes = Math.floor((ms % 3600000) / 60000);
            return `${hours}h ${minutes}m`;
        }

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(0) + 'K';
            }
            return num.toString();
        }

        function generateBar(item) {
            const totalTokens = item.tokens;
            const maxRuntime = Math.max(...data.map(d => d.runtime_ms));
            
            // Calculate bar length based on runtime proportion
            const barLength = Math.round((item.runtime_ms / maxRuntime) * MAX_BAR_CHARS);
            
            // Calculate segment lengths based on token proportions
            const thinkingRatio = item.thinking_tokens / totalTokens;
            const completionRatio = item.completion_tokens / totalTokens;
            const promptRatio = item.prompt_tokens / totalTokens;
            
            const thinkingChars = Math.round(barLength * thinkingRatio);
            const completionChars = Math.round(barLength * completionRatio);
            const promptChars = Math.round(barLength * promptRatio);
            
            let thinkingStr = '';
            let completionStr = '';
            let promptStr = '';
            let emptyStr = '';
            
            if (thinkingChars > 0) {
                thinkingStr = CHAR_THINKING.repeat(thinkingChars);
            }
            if (completionChars > 0) {
                completionStr = CHAR_COMPLETION.repeat(completionChars);
            }
            if (promptChars > 0) {
                promptStr = CHAR_PROMPT.repeat(promptChars);
            }
            
            const usedChars = thinkingChars + completionChars + promptChars;
            if (usedChars < barLength) {
                emptyStr = CHAR_EMPTY.repeat(barLength - usedChars);
            }
            
            return {
                thinking: thinkingStr,
                completion: completionStr,
                prompt: promptStr,
                empty: emptyStr
            };
        }

        function createChart() {
            const chart = document.getElementById('chart');
            
            data.forEach(item => {
                const row = document.createElement('div');
                row.className = 'bar-row';
                row.dataset.item = JSON.stringify(item);
                
                const bar = generateBar(item);
                
                row.innerHTML = `
                    <div class="date-col">${item.date}</div>
                    <div class="bar-col">
                        <span class="segment segment-thinking">${bar.thinking}</span>
                        <span class="segment segment-completion">${bar.completion}</span>
                        <span class="segment segment-prompt">${bar.prompt}</span>
                        <span class="segment empty-space">${bar.empty}</span>
                    </div>
                    <div class="runtime-col">${formatDuration(item.runtime_ms)}</div>
                `;
                
                row.addEventListener('mouseenter', showTooltip);
                row.addEventListener('mousemove', moveTooltip);
                row.addEventListener('mouseleave', hideTooltip);
                
                chart.appendChild(row);
            });
        }

        function showTooltip(e) {
            const item = JSON.parse(e.currentTarget.dataset.item);
            const tooltip = document.getElementById('tooltip');
            
            tooltip.innerHTML = `
                <div class="tooltip-title">${item.date}</div>
                <div class="tooltip-row">
                    <span class="tooltip-label">Runtime:</span>
                    <span class="tooltip-value">${formatDuration(item.runtime_ms)}</span>
                </div>
                <div class="tooltip-row">
                    <span class="tooltip-label">Cost:</span>
                    <span class="tooltip-value">$${item.cost.toFixed(2)}</span>
                </div>
                <div class="tooltip-row">
                    <span class="tooltip-label">Messages:</span>
                    <span class="tooltip-value">${item.messages}</span>
                </div>
                <div class="tooltip-row" style="margin-top: 10px;">
                    <span class="tooltip-label">Total Tokens:</span>
                    <span class="tooltip-value">${formatNumber(item.tokens)}</span>
                </div>
                <div class="tooltip-token-row">
                    <span class="tooltip-token-char segment-thinking">${CHAR_THINKING}</span>
                    <span class="tooltip-label">Thinking:</span>
                    <span class="tooltip-value">${formatNumber(item.thinking_tokens)}</span>
                </div>
                <div class="tooltip-token-row">
                    <span class="tooltip-token-char segment-completion">${CHAR_COMPLETION}</span>
                    <span class="tooltip-label">Completion:</span>
                    <span class="tooltip-value">${formatNumber(item.completion_tokens)}</span>
                </div>
                <div class="tooltip-token-row">
                    <span class="tooltip-token-char segment-prompt">${CHAR_PROMPT}</span>
                    <span class="tooltip-label">Prompt:</span>
                    <span class="tooltip-value">${formatNumber(item.prompt_tokens)}</span>
                </div>
                <div class="tooltip-row" style="margin-top: 10px;">
                    <span class="tooltip-label">Dominant Model:</span>
                    <span class="tooltip-value">${item.dominant_model}</span>
                </div>
            `;
            
            tooltip.style.display = 'block';
        }

        function moveTooltip(e) {
            const tooltip = document.getElementById('tooltip');
            const x = e.clientX + 15;
            const y = e.clientY + 15;
            
            tooltip.style.left = x + 'px';
            tooltip.style.top = y + 'px';
        }

        function hideTooltip() {
            const tooltip = document.getElementById('tooltip');
            tooltip.style.display = 'none';
        }

        // Initialize chart
        createChart();
    </script>
</body>
</html>